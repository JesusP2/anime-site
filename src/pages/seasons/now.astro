---
import MainLayout from "@/layout/main.astro";
import { SeasonNowPage } from "@/components/season-now.page";
import {
  getCurrentSeason,
  getCurrentSeasonCount,
} from "@/lib/anime/data-access";
import { getRecordsPerPage, getCurrentPage } from "@/lib/utils/records-per-page";

const currentPage = getCurrentPage(Astro.url.searchParams);
const { season, year } = Astro.locals.currentSeason;

const animesPerPage = getRecordsPerPage(Astro.url.searchParams);
const searchParams = new URLSearchParams(Astro.url.searchParams);
searchParams.set("season", season);
searchParams.set("year", year.toString());
const [animesCount, animeRecords] = await Promise.all([
  getCurrentSeasonCount(searchParams, animesPerPage),
  getCurrentSeason(searchParams, animesPerPage),
]);
---

<MainLayout title="title">
  <SeasonNowPage
    url={new URL(Astro.url.toString())}
    records={animeRecords}
    count={animesCount}
    currentPage={currentPage}
    recordsPerPage={animesPerPage}
    client:load
  />
</MainLayout>
